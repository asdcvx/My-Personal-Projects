# Web Marketing Window Problems

## Introduction

In the world of digital marketing, data analysis is crucial for understanding user behavior, optimizing campaigns, and making informed decisions. This project demonstrates the application of various SQL window functions to solve common analytical problems in web marketing. By leveraging these functions, marketers can gain deeper insights into campaign performance, user engagement, and revenue trends.

## Background

Window functions in SQL provide a powerful way to perform calculations across a set of table rows related to the current row. Unlike aggregate functions, window functions do not cause rows to become grouped into a single output row, which means they can retain the details of each row while performing the calculation.

In this project, we utilize window functions such as `SUM`, `AVG`, `RANK`, `PERCENT_RANK`, and `LAG` to address specific marketing queries. The dataset `fact_marketing` is assumed to contain key marketing metrics such as revenue, page views, session duration, and conversions, along with dimensional data like user IDs, campaign IDs, device information, and country data.
 
## Problem Statement

The goal of this project is to solve a series of analytical problems using SQL window functions on the `fact_marketing` dataset. Each problem focuses on a different aspect of marketing analysis, such as revenue calculation, user ranking, session duration, and more. The solutions aim to provide actionable insights that can help optimize marketing strategies.

## Problems and Solutions

### Problem 1: Calculate Total Revenue for Each Campaign

**Problem:** Calculate the total revenue generated by each campaign.

**Solution:**

```sql
SELECT
 Campaign_id,
 SUM(Revenue) AS Total_Revenue
FROM
 fact_marketing
GROUP BY
 Campaign_id
ORDER BY
 Total_Revenue DESC;
```

**Interpretation:** This query calculates the total revenue for each marketing campaign and orders the results by the total revenue in descending order, highlighting the most successful campaigns.

### Problem 2: Rank Users by Revenue

**Problem:** Rank users based on the revenue they generated, with the highest revenue ranked first.

**Solution:**

```sql
SELECT
 User_ID,
 Revenue,
 RANK() OVER (ORDER BY Revenue DESC) AS Revenue_Rank
FROM
 fact_marketing;
```

**Interpretation:** This query assigns a rank to each user based on their revenue. Users with the highest revenue receive the highest rank, allowing marketers to identify top-performing users.

### Problem 3: Calculate Running Total of Page Views

**Problem:** Calculate the running total of page views for each user.

**Solution:**

```sql
SELECT
 User_ID,
 Page_Views,
 SUM(Page_Views) OVER (PARTITION BY User_ID ORDER BY Date) AS Running_Total_Page_Views
FROM
 fact_marketing;
```

**Interpretation:** This query calculates a running total of page views for each user over time, providing insights into how user engagement evolves.

### Problem 4: Average Session Duration by Device

**Problem:** Calculate the average session duration for each device category.

**Solution:**

```sql
SELECT
 fd.device_id,
 dd.Device_Category,
 AVG(fd.Session_Duration) OVER (PARTITION BY fd.device_id) AS Avg_Session_Duration
FROM
 fact_marketing fd
JOIN
 dim_device dd ON fd.device_id = dd.device_id;
```

**Interpretation:** This query calculates the average session duration for each device category, helping to understand which devices are associated with longer user sessions.

### Problem 5: Calculate Moving Average of Revenue

**Problem:** Calculate the moving average of revenue over a window of 3 rows for each user.

**Solution:**

```sql
SELECT
 User_ID,
 Date,
 Revenue,
 AVG(Revenue) OVER (PARTITION BY User_ID ORDER BY Date ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS Moving_Avg_Revenue
FROM
 fact_marketing;
```

**Interpretation:** This query calculates the moving average of revenue for each user over the last three records, smoothing out short-term fluctuations and revealing longer-term trends.

### Problem 6: Find Users with Higher-than-Average Revenue

**Problem:** Find users whose revenue is higher than the average revenue of all users.

**Solution:**

```sql
WITH Revenue_CTE AS (
 SELECT
 User_ID,
 Revenue,
 AVG(Revenue) OVER () AS Avg_Revenue
 FROM
 fact_marketing
)
SELECT
 User_ID,
 Revenue,
 Avg_Revenue
FROM
 Revenue_CTE
WHERE
 Revenue > Avg_Revenue;
```

**Interpretation:** This query identifies users whose revenue exceeds the average revenue, highlighting high-value users.

### Problem 7: Cumulative Sum of Conversions by Country

**Problem:** Calculate the cumulative sum of conversions for each country.

**Solution:**

```sql
SELECT
 fc.country_id,
 dc.Country,
 Conversions,
 SUM(Conversions) OVER (PARTITION BY fc.country_id ORDER BY Date) AS Cumulative_Conversions
FROM
 fact_marketing fc
JOIN
 dim_country dc ON fc.country_id = dc.country_id;
```

**Interpretation:** This query calculates the cumulative number of conversions for each country over time, showing the growth in conversions per country.

### Problem 8: Percentile Rank of Revenue

**Problem:** Calculate the percentile rank of revenue for each user.

**Solution:**

```sql
SELECT
 User_ID,
 Revenue,
 PERCENT_RANK() OVER (ORDER BY Revenue DESC) AS Percentile_Rank
FROM
 fact_marketing;
```

**Interpretation:** This query assigns a percentile rank to each user's revenue, allowing for the comparison of users' revenue performance relative to the entire dataset.

### Problem 9: Calculate Difference in Revenue from Previous User

**Problem:** Calculate the difference in revenue from the previous user based on the ordering of revenue.

**Solution:**

```sql
SELECT
 User_ID,
 Revenue,
 Revenue - LAG(Revenue, 1) OVER (ORDER BY Revenue DESC) AS Revenue_Difference
FROM
 fact_marketing;
```

**Interpretation:** This query calculates the difference in revenue between each user and the user ranked immediately before them, providing insights into revenue distribution.

### Problem 10: Identify Top N Users by Revenue within Each Campaign

**Problem:** Identify the top 3 users by revenue within each campaign.

**Solution:**

```sql
SELECT
 Campaign_id,
 User_ID,
 Revenue,
 RANK() OVER (PARTITION BY Campaign_id ORDER BY Revenue DESC) AS Revenue_Rank
FROM
 fact_marketing
WHERE
 RANK() OVER (PARTITION BY Campaign_id ORDER BY Revenue DESC) <= 3;
```

**Interpretation:** This query identifies the top 3 users by revenue within each campaign, allowing for targeted analysis and recognition of top contributors.
